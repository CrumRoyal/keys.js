<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Keys.js by bitwalker</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Keys.js</h1>
        <p>Easy keybindings for browser applications!</p>
        <p class="view"><a href="https://github.com/bitwalker/keys.js">View the Project on GitHub <small>bitwalker/keys.js</small></a></p>
        <ul>
          <li><a href="https://github.com/bitwalker/keys.js/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/bitwalker/keys.js/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/bitwalker/keys.js">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="keysjs" class="anchor" href="#keysjs"><span class="octicon octicon-link"></span></a>Keys.js</h1>

<p>This project spawned out of a Chrome extension I was working on where I kept handling more and more key combinations for shortcut actions, until it eventually became an unmaintainable rats nest. Obviously I needed a solution, and Keys.js was born.</p>

<h2>
<a name="current-state" class="anchor" href="#current-state"><span class="octicon octicon-link"></span></a>Current State</h2>

<p>Stable, but it's a new project, so as always, caveat emptor. The documentation is very close to comprehensive, but some work needs to be done. The test suite is comprehensive, and very few gaps are left to fill there that are meaningful. Please help me identify any gaps in functionality, testing, or docs, by submitting issues so that I can prioritize things as needed.</p>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>This library is intended for use in the browser, but offers support for any CommonJS or AMD module loaders, such as require.js, etc.</p>

<h2>
<a name="external-dependencies" class="anchor" href="#external-dependencies"><span class="octicon octicon-link"></span></a>External Dependencies</h2>

<p>None. I wanted to ensure that Keys could stand on it's own, independent of any third party libraries. This makes it really easy to deploy on an existing project.</p>

<h2>
<a name="architecture" class="anchor" href="#architecture"><span class="octicon octicon-link"></span></a>Architecture</h2>

<p>Keys is composed of three classes that function a bit like a pyramid, starting with the smallest unit (Key) up to a document-wide event manager (Bindings).</p>

<h4>
<a name="key" class="anchor" href="#key"><span class="octicon octicon-link"></span></a>Key</h4>

<p>This class manages information about a single physical key on the keyboard. One can reference a given key instance using <code>Key.A</code> or <code>Key['Num Lock']</code>. There is little need to actually create new instances of Key as all of the keys on the keyboard already have static instances defined.</p>

<h4>
<a name="combo" class="anchor" href="#combo"><span class="octicon octicon-link"></span></a>Combo</h4>

<p>This class manages information about a combination of physical keys on the keyboard. Specifically, one physical key of any type, and any combination of the meta keys (SHIFT, ALT, META, etc). Combos are where we match the keys pressed in a keypress event to the keys required in Combos we wish to execute behavior against (as managed by the Bindings class).</p>

<p>You can create Combos easily using one of the following variations:</p>

<div class="highlight"><pre><span class="c1">// Single meta key</span>
<span class="kd">var</span> <span class="nx">combo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Combo</span><span class="p">(</span><span class="nx">Key</span><span class="p">.</span><span class="nx">A</span><span class="p">,</span> <span class="nx">Key</span><span class="p">.</span><span class="nx">CTRL</span><span class="p">);</span>
<span class="c1">// Multiple meta keys, constructor called as a variadic function</span>
<span class="kd">var</span> <span class="nx">combo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Combo</span><span class="p">(</span><span class="nx">Key</span><span class="p">.</span><span class="nx">A</span><span class="p">,</span> <span class="nx">Key</span><span class="p">.</span><span class="nx">CTRL</span><span class="p">,</span> <span class="nx">Key</span><span class="p">.</span><span class="nx">SHIFT</span><span class="p">);</span>
<span class="c1">// Multiple meta keys passed as an array</span>
<span class="kd">var</span> <span class="nx">combo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Combo</span><span class="p">(</span><span class="nx">Key</span><span class="p">.</span><span class="nx">A</span><span class="p">,</span> <span class="p">[</span> <span class="nx">Key</span><span class="p">.</span><span class="nx">CTRL</span><span class="p">,</span> <span class="nx">Key</span><span class="p">.</span><span class="nx">SHIFT</span> <span class="p">]);</span>
</pre></div>

<h4>
<a name="bindings" class="anchor" href="#bindings"><span class="octicon octicon-link"></span></a>Bindings</h4>

<p>This class manages the mapping of behavior to Combos. It intercepts keydown/keyup document-wide, creates a Combo from the keypress event, matches that Combo against the set of configured keybindings (instances of Combo), and if a match is found, executes any handlers for that Combo and event type (you can have distinct handlers for keydown/keyup). <strong>Note:</strong> You should only ever have one instance of Bindings on the page, or you will encounter duplication/dropping of events.</p>

<p>Bindings offers a simple API for taking Combos and binding behavior to them. First, you use <code>add</code> to create a keybinding:</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">bindings</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Bindings</span><span class="p">();</span>
<span class="nx">bindings</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">'displayAlert'</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Combo</span><span class="p">(</span><span class="nx">Key</span><span class="p">.</span><span class="nx">A</span><span class="p">,</span> <span class="p">[</span> <span class="nx">Key</span><span class="p">.</span><span class="nx">CTRL</span><span class="p">,</span> <span class="nx">Key</span><span class="p">.</span><span class="nx">SHIFT</span> <span class="p">]));</span>
<span class="nx">bindings</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">'toggle'</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Combo</span><span class="p">(</span><span class="nx">Key</span><span class="p">.</span><span class="nx">A</span><span class="p">,</span> <span class="p">[</span> <span class="nx">Key</span><span class="p">.</span><span class="nx">CTRL</span><span class="p">,</span> <span class="nx">Key</span><span class="p">.</span><span class="nx">META</span> <span class="p">]));</span>
</pre></div>

<p>After you've added your keybindings, you can register a handler using <code>registerHandler</code>. You can register multiple handlers for a single event, they will all be executed.</p>

<div class="highlight"><pre><span class="nx">bindings</span><span class="p">.</span><span class="nx">registerHandler</span><span class="p">(</span><span class="s1">'displayAlert'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">alert</span><span class="p">(</span><span class="s1">'Hello!'</span><span class="p">);</span> <span class="p">});</span>
</pre></div>

<p>If you have toggle-like behavior you'd like to implement, you are in luck! Register your toggle using <code>registerToggle</code>:</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">toggleOn</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Lights on!'</span><span class="p">);</span> <span class="p">};</span>
<span class="kd">var</span> <span class="nx">toggleOff</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Lights off!'</span><span class="p">);</span> <span class="p">};</span>
<span class="nx">bindings</span><span class="p">.</span><span class="nx">registerToggle</span><span class="p">(</span><span class="s1">'toggle'</span><span class="p">,</span> <span class="nx">toggleOn</span><span class="p">,</span> <span class="nx">toggleOff</span><span class="p">);</span>
</pre></div>

<p><strong>Note:</strong> The toggle starts in the off position.</p>

<h2>
<a name="full-example" class="anchor" href="#full-example"><span class="octicon octicon-link"></span></a>Full Example</h2>

<div class="highlight"><pre><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"wrapper"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"test"</span> <span class="na">placeholder=</span><span class="s">"Test input.."</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"../src/keys.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
        <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// Toggle Flag</span>
            <span class="kd">var</span> <span class="nx">toggled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

            <span class="c1">// Initialize application-wide bindings manager</span>
            <span class="kd">var</span> <span class="nx">bindings</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">bindings</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Bindings</span><span class="p">();</span>

            <span class="c1">// Add keybindings</span>
            <span class="nx">bindings</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">'displayAlert'</span><span class="p">,</span>   <span class="k">new</span> <span class="nx">Combo</span><span class="p">(</span><span class="nx">Key</span><span class="p">.</span><span class="nx">A</span><span class="p">,</span> <span class="p">[</span> <span class="nx">Key</span><span class="p">.</span><span class="nx">CTRL</span><span class="p">,</span> <span class="nx">Key</span><span class="p">.</span><span class="nx">SHIFT</span> <span class="p">]));</span>
            <span class="nx">bindings</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">'toggleFlag'</span><span class="p">,</span>     <span class="k">new</span> <span class="nx">Combo</span><span class="p">(</span><span class="nx">Key</span><span class="p">.</span><span class="nx">C</span><span class="p">,</span> <span class="p">[</span> <span class="nx">Key</span><span class="p">.</span><span class="nx">SHIFT</span><span class="p">,</span> <span class="nx">Key</span><span class="p">.</span><span class="nx">META</span> <span class="p">]));</span>
            <span class="nx">bindings</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">'highlightInput'</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Combo</span><span class="p">(</span><span class="nx">Key</span><span class="p">.</span><span class="nx">SHIFT</span><span class="p">,</span> <span class="nx">Key</span><span class="p">.</span><span class="nx">META</span><span class="p">));</span>

            <span class="c1">// Register displayAlert handler</span>
            <span class="nx">bindings</span><span class="p">.</span><span class="nx">registerHandler</span><span class="p">(</span><span class="s1">'displayAlert'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">alert</span><span class="p">(</span><span class="s1">'Hello!'</span><span class="p">);</span> <span class="p">});</span>

            <span class="c1">// Register toggleFlag toggle</span>
            <span class="kd">var</span> <span class="nx">toggleOn</span>  <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">toggled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">toggled</span><span class="p">);</span> <span class="p">};</span>
            <span class="kd">var</span> <span class="nx">toggleOff</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">toggled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">toggled</span><span class="p">);</span> <span class="p">};</span>
            <span class="nx">bindings</span><span class="p">.</span><span class="nx">registerToggle</span><span class="p">(</span><span class="s1">'toggleFlag'</span><span class="p">,</span> <span class="nx">toggleOn</span><span class="p">,</span> <span class="nx">toggleOff</span><span class="p">);</span>

            <span class="c1">// Register a pair of handlers on keyup/keydown to highlight a field</span>
            <span class="c1">// while the associated Combo is activated (held down)</span>
            <span class="nx">bindings</span><span class="p">.</span><span class="nx">registerHandler</span><span class="p">(</span><span class="s1">'highlightInput'</span><span class="p">,</span> <span class="s1">'keydown'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'test'</span><span class="p">).</span><span class="nx">style</span><span class="p">[</span><span class="s1">'background-color'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'yellow'</span><span class="p">;</span>
            <span class="p">});</span>
            <span class="nx">bindings</span><span class="p">.</span><span class="nx">registerHandler</span><span class="p">(</span><span class="s1">'highlightInput'</span><span class="p">,</span> <span class="s1">'keyup'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'test'</span><span class="p">).</span><span class="nx">style</span><span class="p">[</span><span class="s1">'background-color'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'white'</span><span class="p">;</span>
            <span class="p">});</span>
        <span class="p">})();</span>
    <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>

<h2>
<a name="todo" class="anchor" href="#todo"><span class="octicon octicon-link"></span></a>TODO</h2>

<p>I feel pretty happy with the current state of this, but as always, bugs and corner cases are sure to arise. A couple things I'd like to do:</p>

<ul>
<li>Comprehensive documentation (good progress already)</li>
<li>Discover additional use cases that aren't covered as well as they could be with Keys</li>
</ul><h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p>This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 Unported License.</p>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/bitwalker">bitwalker</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>